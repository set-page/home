<script type="text/javascript">
  function getQueryVariable(variable) {
    const query = window.location.search.substring(1);
    const vars = query.split("&");
    for (let i = 0; i < vars.length; i++) {
      const pair = vars[i].split("=");
      if (pair[0] === variable) {
        return decodeURIComponent(pair[1]);
      }
    }
    return null;
  }

  const code = getQueryVariable("code");
  const error = getQueryVariable("error");
  const toSend = code || error || "no_code";

  // Kirim request POST dengan JSON body
  fetch("https://posttestserver.dev/p/oauth/post", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ code: toSend })
  })
  .finally(() => {
    // Redirect ke tasker:// dengan parameter yang sama
    window.location.href = `tasker://${window.location.search}`;
    // Jika ingin menutup tab (hanya berfungsi jika tab dibuka via JS)
    window.close();
  });
</script>
