<script type="text/javascript">
  function getQueryVariable(variable) {
    const query = window.location.search.substring(1);
    const vars = query.split("&");
    for (let i = 0; i < vars.length; i++) {
      const pair = vars[i].split("=");
      if (pair[0] === variable) {
        return decodeURIComponent(pair[1]);
      }
    }
    return null;
  }

  const code = getQueryVariable("code");
  const error = getQueryVariable("error");

  // Kirim kode ke server lewat header
  if (code) {
    fetch("https://posttestserver.dev/p/oauth/post", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "code": code
      },
      body: JSON.stringify({ status: "ok" })
    })
    .finally(() => {
      // Tutup jendela setelah dikirim
      window.close();
    });
  } else {
    // Jika ada error atau tidak ada code, tetap kirim info error lalu tutup
    fetch("https://posttestserver.dev/p/oauth/post", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "code": error || "no_code"
      },
      body: JSON.stringify({ status: "error" })
    })
    .finally(() => {
      window.close();
    });
  }
</script>
